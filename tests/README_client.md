# æµå¼TTSå®¢æˆ·ç«¯ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªé’ˆå¯¹å·²éƒ¨ç½²TTSæœåŠ¡çš„æµå¼å®¢æˆ·ç«¯ï¼Œèƒ½å¤Ÿå°†é•¿æ–‡æœ¬æ™ºèƒ½åˆ‡åˆ†åæµå¼å¤„ç†ï¼Œå®ç°è¾¹ç”Ÿæˆè¾¹æ’­æ”¾çš„æ•ˆæœã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **æ™ºèƒ½æ–‡æœ¬åˆ‡åˆ†**: æ”¯æŒæŒ‰å¥å­æˆ–å›ºå®šé•¿åº¦åˆ‡åˆ†é•¿æ–‡æœ¬
- âœ… **æµå¼å¤„ç†**: ä¾æ¬¡å¤„ç†æ–‡æœ¬ç‰‡æ®µï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
- âœ… **å®æ—¶æ’­æ”¾**: ç”Ÿæˆå®Œæˆçš„éŸ³é¢‘ç‰‡æ®µå¯ç«‹å³æ’­æ”¾
- âœ… **è¿›åº¦æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦å’ŒçŠ¶æ€
- âœ… **Webç•Œé¢**: ç¾è§‚çš„HTMLç•Œé¢ï¼Œæ”¯æŒå‚æ•°é…ç½®
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… **æ‰¹é‡æ’­æ”¾**: æ”¯æŒæŒ‰é¡ºåºæ’­æ”¾æ‰€æœ‰ç”Ÿæˆçš„éŸ³é¢‘ç‰‡æ®µ

## æ–‡ä»¶è¯´æ˜

```
tests/
â”œâ”€â”€ streaming_client.py           # Pythonæµå¼å®¢æˆ·ç«¯æ ¸å¿ƒåº“
â”œâ”€â”€ streaming_web_client.html     # Webç•Œé¢å®¢æˆ·ç«¯
â”œâ”€â”€ simple_streaming_test.py      # ç®€å•æµ‹è¯•è„šæœ¬
â””â”€â”€ README_client.md              # æœ¬è¯´æ˜æ–‡æ¡£
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¡®ä¿æœåŠ¡ç«¯è¿è¡Œ

ç¡®ä¿ä½ çš„TTSæœåŠ¡ç«¯å·²å¯åŠ¨å¹¶å¯è®¿é—®ï¼š
```bash
# æµ‹è¯•æœåŠ¡ç«¯æ˜¯å¦å¯ç”¨
curl -X POST http://127.0.0.1:11996/tts_url \
  -H "Content-Type: application/json" \
  -d '{"text": "æµ‹è¯•", "audio_paths": ["/path/to/sample.wav"]}'
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install aiohttp asyncio
```

### 3. ä½¿ç”¨æ–¹å¼

#### æ–¹å¼ä¸€ï¼šWebç•Œé¢ï¼ˆæ¨èï¼‰

1. ç›´æ¥æ‰“å¼€ `streaming_web_client.html`
2. é…ç½®æœåŠ¡å™¨åœ°å€å’Œå‚æ•°
3. è¾“å…¥è¦è½¬æ¢çš„æ–‡æœ¬
4. ç‚¹å‡»"å¼€å§‹æµå¼ç”Ÿæˆ"
5. å®æ—¶æŸ¥çœ‹å¤„ç†è¿›åº¦å’Œæ’­æ”¾éŸ³é¢‘

#### æ–¹å¼äºŒï¼šPythonè„šæœ¬

```bash
# è¿è¡Œç®€å•æµ‹è¯•
python simple_streaming_test.py

# æˆ–ä½¿ç”¨å®Œæ•´çš„å®¢æˆ·ç«¯åº“
python -c "
import asyncio
from streaming_client import StreamingTTSClient

async def test():
    async with StreamingTTSClient('http://127.0.0.1:11996') as client:
        results = await client.process_text_streaming(
            text='ä½ çš„é•¿æ–‡æœ¬å†…å®¹',
            audio_paths=['/path/to/sample.wav'],
            chunk_size=80,
            sentence_split=True
        )
        print(f'ç”Ÿæˆäº† {len(results)} ä¸ªéŸ³é¢‘ç‰‡æ®µ')

asyncio.run(test())
"
```

## é…ç½®å‚æ•°

### æœåŠ¡å™¨è®¾ç½®
- **æœåŠ¡å™¨åœ°å€**: TTSæœåŠ¡çš„URLåœ°å€ï¼ˆé»˜è®¤ï¼š`http://127.0.0.1:11996`ï¼‰
- **éŸ³é¢‘æ ·æœ¬è·¯å¾„**: ç”¨äºè¯­éŸ³å…‹éš†çš„æ ·æœ¬æ–‡ä»¶è·¯å¾„

### æ–‡æœ¬å¤„ç†è®¾ç½®
- **åˆ‡åˆ†å¤§å°**: æ¯ä¸ªæ–‡æœ¬ç‰‡æ®µçš„æœ€å¤§å­—ç¬¦æ•°ï¼ˆå»ºè®®ï¼š60-120ï¼‰
- **æŒ‰å¥å­åˆ‡åˆ†**: æ˜¯å¦ä¼˜å…ˆæŒ‰å¥å­è¾¹ç•Œåˆ‡åˆ†ï¼ˆæ¨èå¼€å¯ï¼‰

### å¤„ç†è®¾ç½®
- **å¹¶å‘å¤„ç†**: æ˜¯å¦å…è®¸å¹¶å‘å¤„ç†å¤šä¸ªç‰‡æ®µï¼ˆå½“å‰ä¸ºé¡ºåºå¤„ç†ï¼‰
- **é‡è¯•æ¬¡æ•°**: å¤„ç†å¤±è´¥æ—¶çš„é‡è¯•æ¬¡æ•°

## APIä½¿ç”¨ç¤ºä¾‹

### Pythonå®¢æˆ·ç«¯ç¤ºä¾‹

```python
import asyncio
from streaming_client import StreamingTTSClient, AudioPlayer

async def streaming_tts_example():
    text = "è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„æ–‡æœ¬å†…å®¹ï¼Œéœ€è¦è¿›è¡Œæµå¼å¤„ç†..."
    audio_paths = ["/path/to/your/sample.wav"]
    
    # åˆ›å»ºå®¢æˆ·ç«¯
    async with StreamingTTSClient("http://127.0.0.1:11996") as client:
        # å®šä¹‰å›è°ƒå‡½æ•°
        async def on_chunk_complete(index, result):
            print(f"å®Œæˆç‰‡æ®µ {index}: {result['text'][:30]}...")
            # è¿™é‡Œå¯ä»¥ç«‹å³æ’­æ”¾æˆ–ä¿å­˜éŸ³é¢‘
            filename = f"output_{index:03d}.wav"
            with open(filename, "wb") as f:
                f.write(result['audio_data'])
        
        # å¼€å§‹æµå¼å¤„ç†
        results = await client.process_text_streaming(
            text=text,
            audio_paths=audio_paths,
            chunk_size=80,
            sentence_split=True,
            on_chunk_complete=on_chunk_complete
        )
        
        print(f"å¤„ç†å®Œæˆï¼Œç”Ÿæˆäº† {len(results)} ä¸ªéŸ³é¢‘ç‰‡æ®µ")

# è¿è¡Œç¤ºä¾‹
asyncio.run(streaming_tts_example())
```

### æ–‡æœ¬åˆ‡åˆ†ç¤ºä¾‹

```python
from streaming_client import TextSplitter

# æŒ‰å¥å­åˆ‡åˆ†
text = "ç¬¬ä¸€å¥è¯ã€‚ç¬¬äºŒå¥è¯ï¼ç¬¬ä¸‰å¥è¯ï¼Ÿ"
chunks = TextSplitter.split_by_sentence(text, max_length=50)
print(chunks)  # ['ç¬¬ä¸€å¥è¯ã€‚', 'ç¬¬äºŒå¥è¯ï¼', 'ç¬¬ä¸‰å¥è¯ï¼Ÿ']

# æŒ‰é•¿åº¦åˆ‡åˆ†
chunks = TextSplitter.split_by_length(text, max_length=10)
print(chunks)  # ['ç¬¬ä¸€å¥è¯ã€‚ç¬¬äºŒå¥è¯', 'ï¼ç¬¬ä¸‰å¥è¯ï¼Ÿ']
```

## Webç•Œé¢ä½¿ç”¨

### ç•Œé¢åŠŸèƒ½

1. **æ–‡æœ¬è¾“å…¥åŒºåŸŸ**
   - æ”¯æŒå¤šè¡Œæ–‡æœ¬è¾“å…¥
   - æ˜¾ç¤ºå­—ç¬¦æ•°ç»Ÿè®¡

2. **å‚æ•°é…ç½®**
   - æœåŠ¡å™¨åœ°å€è®¾ç½®
   - åˆ‡åˆ†å‚æ•°è°ƒæ•´
   - éŸ³é¢‘æ ·æœ¬è·¯å¾„é…ç½®

3. **å¤„ç†æ§åˆ¶**
   - å¼€å§‹/åœæ­¢å¤„ç†æŒ‰é’®
   - æ¸…ç©ºç»“æœåŠŸèƒ½
   - å®æ—¶è¿›åº¦æ˜¾ç¤º

4. **ç»“æœå±•ç¤º**
   - æ¯ä¸ªç‰‡æ®µçš„å¤„ç†çŠ¶æ€
   - éŸ³é¢‘å¤§å°å’Œå¤„ç†æ—¶é—´
   - å•ç‹¬æ’­æ”¾æŒ‰é’®

5. **å…¨å±€æ’­æ”¾æ§åˆ¶**
   - é¡ºåºæ’­æ”¾æ‰€æœ‰ç‰‡æ®µ
   - æ’­æ”¾çŠ¶æ€æ˜¾ç¤º
   - æ’­æ”¾è¿›åº¦æç¤º

### çŠ¶æ€æŒ‡ç¤ºå™¨

- ğŸŸ¡ **å¤„ç†ä¸­**: ç‰‡æ®µæ­£åœ¨ç”ŸæˆéŸ³é¢‘
- ğŸŸ¢ **å·²å®Œæˆ**: ç‰‡æ®µå¤„ç†æˆåŠŸï¼Œå¯ä»¥æ’­æ”¾
- ğŸ”´ **å¤„ç†å¤±è´¥**: ç‰‡æ®µå¤„ç†å‡ºç°é”™è¯¯

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ–‡æœ¬åˆ‡åˆ†ä¼˜åŒ–

1. **åˆç†è®¾ç½®åˆ‡åˆ†å¤§å°**
   - çŸ­æ–‡æœ¬ï¼ˆ<50å­—ç¬¦ï¼‰ï¼šä¸éœ€è¦åˆ‡åˆ†
   - ä¸­ç­‰æ–‡æœ¬ï¼ˆ50-200å­—ç¬¦ï¼‰ï¼šchunk_size=80-120
   - é•¿æ–‡æœ¬ï¼ˆ>200å­—ç¬¦ï¼‰ï¼šchunk_size=60-100

2. **é€‰æ‹©åˆ‡åˆ†æ¨¡å¼**
   - å¥å­åˆ‡åˆ†ï¼šé€‚åˆæ­£å¼æ–‡æœ¬ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´æ€§
   - é•¿åº¦åˆ‡åˆ†ï¼šé€‚åˆè¿ç»­æ–‡æœ¬ï¼Œå¤„ç†é€Ÿåº¦æ›´å¿«

### ç½‘ç»œä¼˜åŒ–

1. **æœåŠ¡å™¨éƒ¨ç½²**
   - ç¡®ä¿æœåŠ¡å™¨æœ‰è¶³å¤Ÿçš„å¤„ç†èƒ½åŠ›
   - è€ƒè™‘ä½¿ç”¨è´Ÿè½½å‡è¡¡

2. **å®¢æˆ·ç«¯ä¼˜åŒ–**
   - é€‚å½“çš„ç‰‡æ®µé—´å»¶è¿Ÿï¼ˆé¿å…æœåŠ¡å™¨è¿‡è½½ï¼‰
   - å®ç°é‡è¯•æœºåˆ¶ï¼ˆå¤„ç†ç½‘ç»œå¼‚å¸¸ï¼‰

### éŸ³é¢‘å¤„ç†ä¼˜åŒ–

1. **éŸ³é¢‘æ ¼å¼**
   - ä½¿ç”¨é€‚å½“çš„éŸ³é¢‘é‡‡æ ·ç‡å’Œæ¯”ç‰¹ç‡
   - è€ƒè™‘éŸ³é¢‘å‹ç¼©ä»¥å‡å°‘ä¼ è¾“æ—¶é—´

2. **ç¼“å­˜ç­–ç•¥**
   - ç¼“å­˜å·²ç”Ÿæˆçš„éŸ³é¢‘ç‰‡æ®µ
   - é¿å…é‡å¤å¤„ç†ç›¸åŒæ–‡æœ¬

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥æœåŠ¡å™¨å¤±è´¥**
   ```
   âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨
   ```
   - æ£€æŸ¥æœåŠ¡å™¨åœ°å€æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **éŸ³é¢‘æ ·æœ¬è·¯å¾„é”™è¯¯**
   ```
   âŒ å¤„ç†å¤±è´¥: éŸ³é¢‘æ–‡ä»¶ä¸å­˜åœ¨
   ```
   - ç¡®è®¤éŸ³é¢‘æ ·æœ¬æ–‡ä»¶å­˜åœ¨
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿æœåŠ¡å™¨æœ‰è®¿é—®æƒé™

3. **æ–‡æœ¬åˆ‡åˆ†å¼‚å¸¸**
   ```
   âŒ æ–‡æœ¬åˆ‡åˆ†å¤±è´¥
   ```
   - æ£€æŸ¥æ–‡æœ¬å†…å®¹æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦
   - è°ƒæ•´åˆ‡åˆ†å‚æ•°
   - å°è¯•ä½¿ç”¨é•¿åº¦åˆ‡åˆ†æ¨¡å¼

4. **æ’­æ”¾å¤±è´¥**
   ```
   âŒ éŸ³é¢‘æ’­æ”¾å¤±è´¥
   ```
   - æ£€æŸ¥æµè§ˆå™¨éŸ³é¢‘æƒé™
   - ç¡®è®¤éŸ³é¢‘æ ¼å¼æ”¯æŒ
   - å°è¯•ä¸‹è½½æ–‡ä»¶æ‰‹åŠ¨æ’­æ”¾

### è°ƒè¯•æ–¹æ³•

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   ```python
   import logging
   logging.basicConfig(level=logging.DEBUG)
   ```

2. **æ£€æŸ¥æœåŠ¡å™¨å“åº”**
   ```bash
   curl -v -X POST http://127.0.0.1:11996/tts_url \
     -H "Content-Type: application/json" \
     -d '{"text": "æµ‹è¯•", "audio_paths": ["/path/to/sample.wav"]}'
   ```

3. **æµ‹è¯•å•ä¸ªç‰‡æ®µ**
   - ä½¿ç”¨çŸ­æ–‡æœ¬æµ‹è¯•åŸºæœ¬åŠŸèƒ½
   - é€æ­¥å¢åŠ æ–‡æœ¬é•¿åº¦
   - æ£€æŸ¥æ¯ä¸ªå¤„ç†é˜¶æ®µ

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„åˆ‡åˆ†ç­–ç•¥

```python
class CustomTextSplitter:
    @staticmethod
    def split_by_keywords(text: str, keywords: list, max_length: int) -> list:
        """åŸºäºå…³é”®è¯çš„æ™ºèƒ½åˆ‡åˆ†"""
        # å®ç°è‡ªå®šä¹‰åˆ‡åˆ†é€»è¾‘
        pass
```

### é›†æˆéŸ³é¢‘æ’­æ”¾åº“

```python
import pygame
import sounddevice as sd

class AdvancedAudioPlayer:
    def __init__(self):
        pygame.mixer.init()
    
    def play_with_effects(self, audio_data, effects=None):
        # æ·»åŠ éŸ³é¢‘ç‰¹æ•ˆå¤„ç†
        pass
```

### å®ç°éŸ³é¢‘ç¼“å­˜

```python
import hashlib
import pickle

class AudioCache:
    def __init__(self, cache_dir="audio_cache"):
        self.cache_dir = Path(cache_dir)
        self.cache_dir.mkdir(exist_ok=True)
    
    def get_cache_key(self, text, audio_paths):
        content = f"{text}:{':'.join(audio_paths)}"
        return hashlib.md5(content.encode()).hexdigest()
    
    def get(self, key):
        cache_file = self.cache_dir / f"{key}.cache"
        if cache_file.exists():
            with open(cache_file, "rb") as f:
                return pickle.load(f)
        return None
    
    def set(self, key, data):
        cache_file = self.cache_dir / f"{key}.cache"
        with open(cache_file, "wb") as f:
            pickle.dump(data, f)
```

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªåŸé¡¹ç›®çš„è®¸å¯è¯è¦æ±‚ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªå®¢æˆ·ç«¯ã€‚
